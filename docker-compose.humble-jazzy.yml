version: '3.8'

services:
  humble-talker:
    build:
      context: .
      dockerfile: docker/Dockerfile.humble
    container_name: humble-talker
    network_mode: host
    environment:
      - ROS_DOMAIN_ID=0
      - ROS_DISTRO=humble
    command: >
      bash -c "source /opt/ros/humble/setup.bash &&
               python3 /ros2_ws/src/talker/talker.py"
    stdin_open: true
    tty: true

  jazzy-listener:
    build:
      context: .
      dockerfile: docker/Dockerfile.jazzy
    container_name: jazzy-listener
    network_mode: host
    environment:
      - ROS_DOMAIN_ID=0
      - ROS_DISTRO=jazzy
    command: >
      bash -c "source /opt/ros/jazzy/setup.bash &&
               echo 'Waiting 5 seconds for talker to start...' &&
               sleep 5 &&
               python3 /ros2_ws/src/listener/listener.py"
    stdin_open: true
    tty: true
    depends_on:
      - humble-talker
